<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js navy">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Basics and General Workflow</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../index.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../CONTRIBUTING.html">Contributing to the Guide</a></li><li class="chapter-item expanded affix "><li class="part-title">General Fansubbing</li><li class="chapter-item expanded "><a href="../overview/preface.html"><strong aria-hidden="true">1.</strong> Preface</a></li><li class="chapter-item expanded "><a href="../overview/roles.html"><strong aria-hidden="true">2.</strong> Roles</a></li><li class="chapter-item expanded "><a href="../overview/requirements.html"><strong aria-hidden="true">3.</strong> Requirements</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Collaboration</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../subtitling/collaboration/ftp.html"><strong aria-hidden="true">4.1.</strong> With FTP</a></li><li class="chapter-item expanded "><a href="../subtitling/collaboration/github.html"><strong aria-hidden="true">4.2.</strong> With git (via GitHub)</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Encoding</li><li class="chapter-item expanded "><a href="../encoding/preparation.html"><strong aria-hidden="true">5.</strong> Preparations and Necessary Software</a></li><li class="chapter-item expanded "><a href="../encoding/basics-and-workflow.html" class="active"><strong aria-hidden="true">6.</strong> Basics and General Workflow</a></li><li class="chapter-item expanded "><a href="../encoding/video-artifacts.html"><strong aria-hidden="true">7.</strong> Recognizing Video Artifacts</a></li><li class="chapter-item expanded "><a href="../encoding/scenefiltering.html"><strong aria-hidden="true">8.</strong> Scenefiltering</a></li><li class="chapter-item expanded "><a href="../encoding/masking-limiting-etc.html"><strong aria-hidden="true">9.</strong> Masking, Limiting, and Related Functions</a></li><li class="chapter-item expanded "><a href="../encoding/descaling.html"><strong aria-hidden="true">10.</strong> Descaling</a></li><li class="chapter-item expanded "><a href="../encoding/resampling.html"><strong aria-hidden="true">11.</strong> Resampling</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.</strong> Codecs</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../encoding/codecs/x264.html"><strong aria-hidden="true">12.1.</strong> x264</a></li><li class="chapter-item expanded "><a href="../encoding/codecs/x265.html"><strong aria-hidden="true">12.2.</strong> x265</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Typesetting</li><li class="chapter-item expanded "><a href="../typesetting/aegisub.html"><strong aria-hidden="true">13.</strong> Aegisub and Other Tools</a></li><li class="chapter-item expanded "><a href="../typesetting/masking/index.html"><strong aria-hidden="true">14.</strong> Masking With PS &amp; AI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../typesetting/masking/image-processing.html"><strong aria-hidden="true">14.1.</strong> Image Processing in PS</a></li><li class="chapter-item expanded "><a href="../typesetting/masking/image-tracing.html"><strong aria-hidden="true">14.2.</strong> Image Tracing in AI</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Resources and References</li><li class="chapter-item expanded "><a href="../archived-websites/bt601-vs-bt709.html"><strong aria-hidden="true">15.</strong> Colorspaces</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="../impressum.html">Impressum</a></li><li class="chapter-item expanded affix "><a href="../privacy-policy.html">Privacy Policy</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/Irrational-Encoding-Wizardry/guide.encode.moe" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#basics-and-general-workflow" id="basics-and-general-workflow">Basics and General Workflow</a></h1>
<h2><a class="header" href="#preparation" id="preparation">Preparation</a></h2>
<p>downloading a source, looking at the video, some decisions
(resolution(s) for the release, audio codec, group-specific
requirements)</p>
<h2><a class="header" href="#writing-the-script" id="writing-the-script">Writing the Script</a></h2>
<p>imports, source filter (mention lsmash, ffms2), examples for resizing,
debanding, AA. with images if possible</p>
<h2><a class="header" href="#encoding-the-result" id="encoding-the-result">Encoding the Result</a></h2>
<pre><code class="language-sh">$ vspipe.exe script.vpy -y - | x264.exe --demuxer y4m --some example --parameters here --output video.264 -
</code></pre>
<p>Editors for VapourSynth usually have inbuilt support for encoding
scripts you wrote. Use <code>%encode --y4m &lt;clip_variable&gt;</code> in Yuuno or the GUI
provided by VSEdit.</p>
<h2><a class="header" href="#transcoding-audio" id="transcoding-audio">Transcoding Audio</a></h2>
<p>As said earlier, only <em>qaac</em> will require configuration,
everything else can simply be extracted wherever you like.
Nonetheless, it is easier to add every binary you use to the PATH environment variable,
and the rest of this guide will assume you’ve done exactly that.</p>
<h3><a class="header" href="#decoding-audio-with-ffmpeg-and-piping-it-out" id="decoding-audio-with-ffmpeg-and-piping-it-out">Decoding audio with FFmpeg and piping it out</a></h3>
<p>Basic <em>ffmpeg</em> usage is simple.
You just need to specify your input file and your desired output file, like this:</p>
<pre><code class="language-sh">ffmpeg -i &quot;input.dtshd&quot; &quot;output.wav&quot;
</code></pre>
<p>This command will decode the <em>DTS-HD MA</em> audio file and encode it as a WAVE file.
This command doesn’t specify any options so <em>ffmpeg</em> will resort to using its defaults.</p>
<p>For transcoding from <em>DTS-HD MA</em>
only one option is needed:</p>
<pre><code class="language-sh">ffmpeg -i &quot;input.dtshd&quot; -c:a pcm_s24le &quot;output.wav&quot;
</code></pre>
<p>The <code>-c:a pcm_s24le</code> parameter will tell <em>ffmpeg</em> to encode its output with a depth of 24 bits.
If your source file is 16 bits,
change this parameter to <code>pcm_s16le</code> or simply skip it
because 16 bits is the default.</p>
<p><a name="16bps"></a></p>
<div class="info box"><div>
<p>16 bits per sample are,
in almost all situation and most definitely also for anime,
more than enough data points to store audio data.
Thus, you should use 16 bits per sample in your output formats
and only use 24 bits for the intermediate <em>WAVE</em> file,
<em>iff</em> your source file already used 24 bits to begin with.</p>
<p>Refer also to the following article:</p>
<ul>
<li><a href="https://people.xiph.org/%7Exiphmont/demo/neil-young.html">24/192 Music Downloads and why they make no sense</a></li>
</ul>
</div></div>
<p>The command above will decode the source file
and save a resulting <em>WAVE</em> file on your drive.
You can then encode this <em>WAVE</em> file to a <em>FLAC</em> or <em>AAC</em> file,
but there is a faster and more convenient way to do that: piping.
Piping skips the process of writing
and reading the data to and from a file
and simply sends the data straight from one program to another.</p>
<p>To pipe from <em>ffmpeg</em>, specify the output format as <em>WAVE</em> using the <code>-f</code> option,
replace the output filename with a hyphen and place a pipe symbol at the end,
which will be used to separate the <em>ffmpeg</em> command from your encoder command,
like this:</p>
<pre><code class="language-sh">ffmpeg -i &quot;input.dtshd&quot; -c:a pcm_s24le -f wav - | {encoder command}
</code></pre>
<h3><a class="header" href="#encoding-to-flac" id="encoding-to-flac">Encoding to FLAC</a></h3>
<p>To encode to <em>FLAC</em>, we will use the <code>flac</code> command line program:</p>
<pre><code class="language-sh">flac -8 --ignore-chunk-sizes --bps 16 &quot;input.wav&quot; -o &quot;output.flac&quot;
</code></pre>
<p><code>-8</code> sets the encoding level to 8, the maximum level.
This will result in the best compression,
although at the expense of encoding speed.
<em>FLAC</em> encoding is fast, so just stick with level 8.</p>
<p><code>--ignore-chunk-sizes</code> is needed
because the <em>WAVE</em> format only supports audio data up to 4 GiB.
This is a way to work around that limitation.
It will ignore the length field in the header of the <em>WAVE</em> file,
allowing the <em>FLAC</em> encoder to read files of any size.</p>
<p><code>--bps 16</code> specifies the “bits per sample” to be 16.
As noted <a href="#16bps">earlier</a>,
16 bits are enough for our purposes
and <em>FLAC</em> additionally has the downside
that all 24-bit samples are padded to 32-bit samples in the format,
meaning 25% of the storage used is completely wasted.</p>
<p>To encode audio piped from <em>ffmpeg</em>,
replace the input filename with a hyphen
and place the whole command after the <code>ffmpeg</code> command,
like this:</p>
<pre><code class="language-sh">ffmpeg -i &quot;input.dtshd&quot; -c:a pcm_s24le -f wav - | flac -8 --ignore-chunk-sizes --bps 16 - -o &quot;output.flac&quot;
</code></pre>
<h3><a class="header" href="#encoding-to-aac" id="encoding-to-aac">Encoding to AAC</a></h3>
<p>First, set up <em>qaac</em>:</p>
<ul>
<li>Go to <a href="https://sites.google.com/site/qaacpage/">its download page</a> and download the newest build
(2.70 at the time of writing) and <code>makeportable.zip</code>.</li>
<li>Extract the <code>x64</code> folder wherever you want <code>qaac</code> to be,
then extract contents of <code>makeportable.zip</code> inside it.</li>
<li>Download the <a href="https://secure-appldnld.apple.com/itunes12/001-37026-20200915-5CBD39A0-F7A0-11EA-BB8F-8EB5DD073FF6/iTunes64Setup.exe">iTunes setup file</a> (<code>iTunes64Setup.exe</code>)
and move it to the <code>x64</code> folder.</li>
<li>Run the <code>makeportable.cmd</code> script</li>
<li>You are done.
You can now delete the iTunes installation file.</li>
</ul>
<p>To encode from a file, use the following command:</p>
<pre><code class="language-sh">qaac64 --tvbr 91 --ignorelength --no-delay &quot;input.wav&quot; -o &quot;output.m4a&quot;
</code></pre>
<p>The <code>--tvbr 91</code> option sets the encoding mode to True Variable Bitrate
(in other words, constant quality)
and sets the desired quality.
<em>qaac</em> has only 15 actual quality steps in intervals of 9 (0, 9, 18, ... 127).
The higher the number, the higher the resulting bitrate will be.
The recommended value is 91, which will result in a bitrate
of about 192 kbps on 2.0 channel files,
enough for complete transparency in the vast majority of cases.</p>
<p><code>--ignorelength</code> performs the same function as <code>--ignore-chunk-sizes</code> in FLAC.
<code>--no-delay</code> is needed for proper audio/video sync<sup class="footnote-reference"><a href="#1">1</a></sup>.</p>
<p>To encode audio piped from <em>ffmpeg</em>,
replace the input filename with a hyphen
and place the whole command after the <code>ffmpeg</code> command:</p>
<pre><code class="language-sh">ffmpeg -i &quot;input.dtshd&quot; -c:a pcm_s24le -f wav - | qaac64 --tvbr 91 --ignorelength --no-delay - -o &quot;output.m4a&quot;
</code></pre>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>Read why in this <a href="https://hydrogenaud.io/index.php/topic,85135.msg921707.html#msg921707">HydrogenAudio forum post</a>.</p>
</div>
<h3><a class="header" href="#encoding-to-opus" id="encoding-to-opus">Encoding to Opus</a></h3>
<p>Encoding a file with <code>opusenc</code> will look like this:</p>
<pre><code class="language-sh">opusenc --vbr --bitrate 160 --ignorelength &quot;input.wav&quot; &quot;output.opus&quot;
</code></pre>
<p><code>--vbr</code> sets the encoding mode to Variable Bitrate (which is the default but it
never hurts to be explicit),
while <code>--ignorelength</code> does the same thing as in <code>qaac</code>.</p>
<p>As you may have noticed,
<code>opusenc</code> uses bitrate control
rather than some kind of constant quality mode<sup class="footnote-reference"><a href="#2">2</a></sup>.
Instead of an abstract number that corresponds to a quality target
like with <code>x264</code>‘s CRF mode and <code>qaac</code>‘s TVBR mode,
you give the encoder your preferred resulting bitrate and it chooses the constant quality target itself.
The recommended bitrate is 160 kbps for 2.0 channels
and 320 kbps for 5.1.</p>
<p>Encoding audio piped from <code>ffmpeg</code> works the same as for previous encoders—just replace the input filename with a hyphen:</p>
<pre><code class="language-sh">ffmpeg -i &quot;input.dtshd&quot; -c:a pcm_s24le -f wav - | opusenc --vbr --bitrate 160 --ignorelength - &quot;output.opus&quot;
</code></pre>
<div class="footnote-definition" id="2"><sup class="footnote-definition-label">2</sup>
<p><a href="https://wiki.hydrogenaud.io/index.php?title=Opus#Characteristics">A more in-depth explanation on HydrogenAudio</a></p>
</div>
<h2><a class="header" href="#muxing" id="muxing">Muxing</a></h2>
<p>mkvtoolnix</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../encoding/preparation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../encoding/video-artifacts.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../encoding/preparation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../encoding/video-artifacts.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
